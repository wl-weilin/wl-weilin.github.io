---
layout: post
# 标题配置
title:  Activity生命周期
# 时间配置
date:   2021-08-20
# 大类配置
categories: Android-Framework
# 小类配置
tag: Activity
# 设置文章置顶
topping: true

# 资源根路径，该项在Jekyll网页显示时无用
typora-root-url: ./..\..

---

* content
{:toc}


# 概述

## 生命周期大致过程

[了解 Activity 生命周期——developer.android](https://developer.android.com/guide/components/activities/activity-lifecycle)



<div style="text-align: center">
    <img src="/wl-docs/Android Framework/AMS/Activity生命周期/Activity生命周期.png" alt="Activity生命周期.png" style="zoom:80%" />
</div>





(1) onCreate

&emsp;&emsp;系统首次创建 Activity 时触发。Activity 会在创建后进入“已创建”状态。在 onCreate() 方法中，您需执行基本应用启动逻辑，该逻辑在 Activity 的整个生命周期中只应发生一次。

(2) onStart
&emsp;&emsp;当 Activity 进入“已开始”状态时，系统会调用此回调。onStart() 调用使 Activity 对用户可见，因为应用会为 Activity 进入前台并支持互动做准备。

&emsp;&emsp;onStart() 方法会非常快速地完成，并且与“已创建”状态一样，Activity 不会一直处于“已开始”状态。一旦此回调结束，Activity 便会进入“已恢复”状态，系统将调用 onResume() 方法。

(3)   onResume

&emsp;&emsp;Activity 会在进入“已恢复”状态时来到前台，然后系统调用 onResume() 回调。这是应用与用户互动的状态。应用会一直保持这种状态，直到某些事件发生（如包括接到来电、用户导航到另一个 Activity，或设备屏幕关闭），让焦点远离应用。

&emsp;&emsp;如果 Activity 从“已暂停”状态返回“已恢复”状态，系统将再次调用 onResume() 方法。因此，您应实现 onResume()，以初始化在 onPause() 期间释放的组件，并执行每次 Activity 进入“已恢复”状态时必须完成的任何其他初始化操作。

(4)   onPause

&emsp;&emsp;系统将此方法视为用户将要离开您的 Activity 的第一个标志（尽管这并不总是意味着 Activity 会被销毁）；此方法表示 Activity 不再位于前台（尽管在用户处于多窗口模式时 Activity 仍然可见）。使用 onPause() 方法暂停或调整当 Activity 处于“已暂停”状态时不应继续（或应有节制地继续）的操作，以及您希望很快恢复的操作。Activity 进入此状态的原因有很多。例如：

- 如 onResume() 部分所述，某个事件会中断应用执行。这是最常见的情况。

- 在 Android 7.0（API 级别 24）或更高版本中，有多个应用在多窗口模式下运行。无论何时，都只有一个应用（窗口）可以拥有焦点，因此系统会暂停所有其他应用。

- 有新的半透明 Activity（例如对话框）处于开启状态。只要 Activity 仍然部分可见但并未处于焦点之中，它便会一直暂停。

(5)   onStop

&emsp;&emsp;如果您的 Activity 不再对用户可见，说明其已进入“已停止”状态，因此系统将调用 onStop() 回调。例如，当新启动的 Activity 覆盖整个屏幕时，可能会发生这种情况。如果 Activity 已结束运行并即将终止，系统还可以调用 onDestroy()。

(6)   onRestart

&emsp;&emsp;onRestart 是当处于非栈顶状态的活动需要再次返回栈顶，即展现给用户的时候，触发该方法。

&emsp;&emsp;也就是说执行了onStop()且没有执行onDestroy()的Activity被重新激活时，就会调用onRestart()方法。

(7)   onDestroy

&emsp;&emsp;销毁 Ativity 之前，系统会先调用 onDestroy()。系统调用此回调的原因如下：

- Activity 即将结束，由于用户彻底关闭 Activity 或由于系统为 Activity 调用 finish()；

- 由于配置变更（例如设备旋转或多窗口模式），系统暂时销毁 Activity。



## onStop与onDestroy-返回键

[Activity#onBackPressed()——developer.android](https://developer.android.com/reference/android/app/Activity#onBackPressed())

&emsp;&emsp;Android 11及之前按下返回键后Activity的生命周期正常会回调onDestroy，Google在Android 12上修改了按下返回键后Activity的生命周期回调，当Activity声明了ACTION_MAIN和CATEGORY_LAUNCHER的filter，按返回键后会将该activity放到活动栈，其他的普通Activity会被finish。

## onPause和onStop的区别

&emsp;&emsp;onPause表示当前Activity失去焦点，onStop表示当前页面不可见。

&emsp;&emsp;一般情况下，Activity失去焦点后就不可见了。但有些情况下，即使失去焦点但依旧可见。关于在什么情况下只执行onPause，网上有很多说法。经试验，目前遇到的只有当“新的半透明 Activity覆盖在当前Activity上”时，才会只执行onPause。

 

半透明的Activity通常包括以下情况：

- 自定义的dialog继承自Activity；

- 新启动的Activity的主题为android:theme="@style/Theme.AppCompat.Dialog"（继承自AppCompatActivity类时）或android:theme="@android:style/Theme.Dialog"（继承自Activity类时）。

&emsp;&emsp;另外要注意区分对话框和半透明Activity的区别，有的半透明Activity比较特殊，看着比较像对话框，如USB连接弹窗（实质是继承自Activity的dialog）。当它出现在其它Activity上时，该Activity的生命周期只会执行到onPause。